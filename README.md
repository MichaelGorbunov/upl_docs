# Docs Service Сервис обработки загруженных документов

## Описание проекта

Проект представляет собой REST API сервис для загрузки документов зарегистрированными пользователями.
При загрузке нового документа администратору приходит уведомление по электронной почте.
В Django admin добавлены  быстрые действия для подтверждения или отклонения загруженных документов.
Настроена отправка уведомлений по электронной почте пользователю, когда его документ подтвержден или отклонен.

## Технологии

- Python 3.12
- Django 5.1
- Django REST Framework
- PostgreSQL
- Celery
- Redis
- Simple JWT
- Swagger/drf-yasg
- Docker & Docker Compose
- Nginx



### Локальная разработка

1. Клонировать репозиторий:

   ```bash
   git clone --branch develop --single-branch https://github.com/MichaelGorbunov/upl_docs
   ```

2. Создать файл `.env` на основе `.env.example`:

   ```bash
   cp .env_sample .env
   ```

   Заполнить необходимые переменные окружения в файле .env

3. Собрать и запустить контейнеры:

   ```bash
   docker-compose up -d --build
   ```

4. Проект будет доступен по адресу: http://localhost:8000

### Остановка проекта

```bash
docker-compose down
```

## API Endpoints


- `GET /docs/download/<int:pk>/` - Скачивание документа
- `POST /docs/create/` - Создание нового документа
- `DELETE /docs/delete/<int:pk>/` - Удаление документа
- `GET /docs/list/` - Список документов


- `/swagger/` - Swagger документация



- `POST /users/users/` - Регистрация пользователя
- `POST /users/login` - Получение JWT токена
- `GET /users/users/` - Информация о пользователе
- `PATCH /users/users/<int:pk>` - Обновление информации о пользователе
- `DELETE /users/users/<int:pk>` - Удаление пользователя
- `GET /users/users/` - Список пользователей
- `POST /users/token_refresh/` - Получение JWT токена

## Настройка CI/CD

### GitHub Actions

1. Добавьте следующие секреты в настройки GitHub репозитория:

   - `SERVER_HOST` - IP-адрес вашего сервера
   - `SERVER_USER` - Имя пользователя на сервере
   - `SSH_PRIVATE_KEY` - SSH-ключ для доступа к серверу
   - `DEPLOY_DIR` - Папка для развертывания

2. При пуше в ветку main автоматически запускаются:

   - Линтинг кода
   - Тесты   
   - Деплой на сервер
   - Сборка Docker образов
   

### Настройка сервера

1. Установите Docker:

   ```bash
   sudo apt update
   sudo apt install docker.io
   ```

2. Установите Docker Compose:

   ```bash
   sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   sudo chmod +x /usr/local/bin/docker-compose
   ```

3. Настройте SSH доступ для GitHub Actions

## Функциональность

- Регистрация и авторизация пользователей
- CRUD операции с документами 
- Отправка уведомлений
- Отложенные задачи через Celery
- API документация (Swagger/ReDoc)

## Тестирование

1. Запуск тестов:

```bash
python manage.py test

```
2. Уровень покрытия тестами:

```bash
coverage run --source='.' manage.py test
coverage report
```

# Исходное задание для сервиса обработки загружаемых документов

- OB3
- Backend
- PostgreSQL
- ORM
- CORS
- Git
- Readme
- PEP8
- OpenAPI Docs
- Docker
- Docker-Compose
- Tests
- Django
- DRF

## Описание задачи:

Необходимо создать сервис для обработки загружаемых документов. Сервис должен позволять зарегистрированным пользователям загружать документы через API. При загрузке документа администратор платформы должен получать уведомление по электронной почте. Администратор сможет просматривать, подтверждать или отклонять загруженные документы через Django admin. После подтверждения или отклонения документа пользователю, загрузившему документ, должно приходить уведомление по электронной почте. Для обработки уведомлений необходимо использовать систему очередей.

## Задача

Создать API для загрузки документов зарегистрированными пользователями.
Настроить уведомление администратора по электронной почте при загрузке нового документа.
Добавить в Django admin быстрые действия для подтверждения или отклонения загруженных документов.
Настроить отправку уведомлений по электронной почте пользователю, когда его документ подтвержден или отклонен.
Реализовать систему очередей для отправки уведомлений.
Технические требования:

- Фреймворк:
Использовать фреймворк Django и Django Rest Framework (DRF) для реализации проекта.
- База данных:
Использовать PostgreSQL для хранения данных.
- Контейнеризация:
Использовать Docker и Docker compose для контейнеризации приложения.
- Очередь сообщений:
Использовать Celery или другую систему очередей для отправки уведомлений.
- Отправка уведомлений:
Настроить отправку уведомлений по электронной почте с использованием Django.

## Документация:
В корне проекта должен быть файл README.md с описанием структуры проекта и инструкциями по установке и запуску.
Реализовать автогенерируемую документацию API с использованием Swagger.
- Качество кода:
Соблюдать стандарты PEP8.
Весь код должен храниться в удаленном Git репозитории.
- Тестирование:
Код должен быть покрыт тестами с покрытием не менее 75%.
